<!-- Profile Page -->
<div class="pb-24">
    <div class="p-4">
        <!-- Header -->
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800" x-text="t.profile.title"></h2>
            <button @click="editingProfile = !editingProfile" class="btn btn-outline btn-sm">
                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                <span x-text="editingProfile ? t.common.cancel : t.common.edit"></span>
            </button>
        </div>
        
        <!-- Profile Card -->
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
            <div class="flex items-center mb-6">
                <div class="relative">
                    <div class="w-20 h-20 bg-coop-100 rounded-full flex items-center justify-center mr-4">
                        <span class="text-4xl" x-text="user?.avatar || 'ðŸ‘¤'"></span>
                    </div>
                    <template x-if="editingProfile">
                        <button class="absolute -bottom-1 -right-1 w-8 h-8 bg-coop-500 rounded-full flex items-center justify-center text-white shadow-lg">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </button>
                    </template>
                </div>
                <div class="flex-1">
                    <template x-if="!editingProfile">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800" x-text="getUserName()"></h3>
                            <p class="text-sm text-gray-500" x-text="user?.nickname"></p>
                            <span class="badge mt-2" :class="getRoleBadgeClass()" x-text="getRoleFullName()"></span>
                        </div>
                    </template>
                    <template x-if="editingProfile">
                        <div class="space-y-2">
                            <input type="text" class="input w-full text-lg font-bold" :value="user?.name" placeholder="åå‰">
                            <input type="text" class="input w-full text-sm" :value="user?.nickname" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ">
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Basic Info -->
            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <p class="text-gray-500 text-xs mb-1" x-text="t.common.memberNumber"></p>
                    <p class="font-medium" x-text="user?.id"></p>
                </div>
                <div>
                    <p class="text-gray-500 text-xs mb-1" x-text="t.common.area"></p>
                    <template x-if="!editingProfile">
                        <p class="font-medium" x-text="getUserArea()"></p>
                    </template>
                    <template x-if="editingProfile">
                        <select class="input w-full text-sm">
                            <template x-for="area in CoopData.areas" :key="area.id">
                                <option :value="area.id" :selected="area.name === user?.area" x-text="language === 'en' ? area.nameEn : area.name"></option>
                            </template>
                        </select>
                    </template>
                </div>
                <div>
                    <p class="text-gray-500 text-xs mb-1" x-text="t.profile.memberSince"></p>
                    <p class="font-medium" x-text="formatDate(user?.memberSince)"></p>
                </div>
                <div>
                    <p class="text-gray-500 text-xs mb-1">Email</p>
                    <p class="font-medium" x-text="user?.email"></p>
                </div>
            </div>
        </div>
        
        <!-- Bio -->
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
            <h4 class="font-bold text-gray-800 mb-3" x-text="language === 'ja' ? 'è‡ªå·±ç´¹ä»‹' : 'About Me'"></h4>
            <template x-if="!editingProfile">
                <p class="text-gray-700 text-sm" x-text="language === 'en' && user?.bioEn ? user.bioEn : user?.bio"></p>
            </template>
            <template x-if="editingProfile">
                <textarea class="input w-full h-24 text-sm resize-none" :value="user?.bio" placeholder="è‡ªå·±ç´¹ä»‹ã‚’æ›¸ã„ã¦ãã ã•ã„..."></textarea>
            </template>
        </div>
        
        <!-- Services Offered -->
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
            <h4 class="font-bold text-gray-800 mb-4" x-text="t.profile.servicesOffered"></h4>
            <template x-if="!editingProfile">
                <div class="flex flex-wrap gap-2">
                    <template x-for="service in user?.servicesOffered || []" :key="service">
                        <span class="px-3 py-1.5 rounded-full text-sm border" :class="getCategoryColor(getServiceCategory(service)?.color)">
                            <span x-text="getServiceCategory(service)?.icon"></span>
                            <span x-text="language === 'en' ? getServiceCategory(service)?.nameEn : getServiceCategory(service)?.name"></span>
                        </span>
                    </template>
                    <template x-if="!user?.servicesOffered?.length">
                        <p class="text-sm text-gray-500">â€”</p>
                    </template>
                </div>
            </template>
            <template x-if="editingProfile">
                <div class="grid grid-cols-2 gap-2">
                    <template x-for="cat in CoopData.serviceCategories" :key="cat.id">
                        <button 
                            :class="user?.servicesOffered?.includes(cat.id) ? 'ring-2 ring-coop-500 bg-coop-50' : 'bg-gray-50'"
                            class="p-3 rounded-lg text-left transition-all">
                            <span class="text-xl" x-text="cat.icon"></span>
                            <p class="text-sm font-medium mt-1" x-text="language === 'en' ? cat.nameEn : cat.name"></p>
                        </button>
                    </template>
                </div>
            </template>
        </div>
        
        <!-- Services Needed -->
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
            <h4 class="font-bold text-gray-800 mb-4" x-text="t.profile.servicesNeeded"></h4>
            <template x-if="!editingProfile">
                <div class="flex flex-wrap gap-2">
                    <template x-for="service in user?.servicesNeeded || []" :key="service">
                        <span class="px-3 py-1.5 rounded-full text-sm border" :class="getCategoryColor(getServiceCategory(service)?.color)">
                            <span x-text="getServiceCategory(service)?.icon"></span>
                            <span x-text="language === 'en' ? getServiceCategory(service)?.nameEn : getServiceCategory(service)?.name"></span>
                        </span>
                    </template>
                    <template x-if="!user?.servicesNeeded?.length">
                        <p class="text-sm text-gray-500">â€”</p>
                    </template>
                </div>
            </template>
            <template x-if="editingProfile">
                <div class="grid grid-cols-2 gap-2">
                    <template x-for="cat in CoopData.serviceCategories" :key="cat.id">
                        <button 
                            :class="user?.servicesNeeded?.includes(cat.id) ? 'ring-2 ring-coop-500 bg-coop-50' : 'bg-gray-50'"
                            class="p-3 rounded-lg text-left transition-all">
                            <span class="text-xl" x-text="cat.icon"></span>
                            <p class="text-sm font-medium mt-1" x-text="language === 'en' ? cat.nameEn : cat.name"></p>
                        </button>
                    </template>
                </div>
            </template>
        </div>
        
        <!-- Availability -->
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
            <h4 class="font-bold text-gray-800 mb-4" x-text="t.profile.availability"></h4>
            <div class="overflow-x-auto -mx-2 px-2">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="text-gray-500">
                            <th class="text-left py-2 pr-2"></th>
                            <th class="text-center py-2 px-1" x-text="t.profile.timeSlots.morning"></th>
                            <th class="text-center py-2 px-1" x-text="t.profile.timeSlots.afternoon"></th>
                            <th class="text-center py-2 px-1" x-text="t.profile.timeSlots.evening"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(dayKey, index) in ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday']" :key="dayKey">
                            <tr class="border-t">
                                <td class="py-2 pr-2 font-medium text-gray-700" x-text="t.profile.days[dayKey]"></td>
                                <td class="text-center py-2 px-1">
                                    <template x-if="!editingProfile">
                                        <span x-text="user?.availability?.[dayKey]?.includes('morning') ? 'âœ“' : 'â€”'" :class="user?.availability?.[dayKey]?.includes('morning') ? 'text-coop-600 font-bold' : 'text-gray-300'"></span>
                                    </template>
                                    <template x-if="editingProfile">
                                        <input type="checkbox" class="w-5 h-5 text-coop-600 rounded" :checked="user?.availability?.[dayKey]?.includes('morning')">
                                    </template>
                                </td>
                                <td class="text-center py-2 px-1">
                                    <template x-if="!editingProfile">
                                        <span x-text="user?.availability?.[dayKey]?.includes('afternoon') ? 'âœ“' : 'â€”'" :class="user?.availability?.[dayKey]?.includes('afternoon') ? 'text-coop-600 font-bold' : 'text-gray-300'"></span>
                                    </template>
                                    <template x-if="editingProfile">
                                        <input type="checkbox" class="w-5 h-5 text-coop-600 rounded" :checked="user?.availability?.[dayKey]?.includes('afternoon')">
                                    </template>
                                </td>
                                <td class="text-center py-2 px-1">
                                    <template x-if="!editingProfile">
                                        <span x-text="user?.availability?.[dayKey]?.includes('evening') ? 'âœ“' : 'â€”'" :class="user?.availability?.[dayKey]?.includes('evening') ? 'text-coop-600 font-bold' : 'text-gray-300'"></span>
                                    </template>
                                    <template x-if="editingProfile">
                                        <input type="checkbox" class="w-5 h-5 text-coop-600 rounded" :checked="user?.availability?.[dayKey]?.includes('evening')">
                                    </template>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Privacy Settings -->
        <div class="bg-white rounded-xl p-6 shadow-sm mb-6">
            <h4 class="font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <span x-text="t.profile.privacySettings"></span>
            </h4>
            
            <div class="space-y-4">
                <!-- Show Real Name -->
                <div class="flex items-center justify-between">
                    <div>
                        <p class="font-medium text-gray-700" x-text="t.profile.showRealName"></p>
                        <p class="text-xs text-gray-500" x-text="language === 'ja' ? 'ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§æœ¬åã‚’è¡¨ç¤ºã™ã‚‹' : 'Display your real name in community'"></p>
                    </div>
                    <template x-if="!editingProfile">
                        <span class="px-3 py-1 rounded-full text-xs font-medium" :class="user?.privacy?.showRealName ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'" x-text="user?.privacy?.showRealName ? t.common.yes : t.common.no"></span>
                    </template>
                    <template x-if="editingProfile">
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" class="sr-only peer" :checked="user?.privacy?.showRealName">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-coop-500"></div>
                        </label>
                    </template>
                </div>
                
                <!-- Location Precision -->
                <div class="flex items-center justify-between">
                    <div>
                        <p class="font-medium text-gray-700" x-text="t.profile.locationPrecision"></p>
                        <p class="text-xs text-gray-500" x-text="language === 'ja' ? 'è¡¨ç¤ºã™ã‚‹ä½ç½®æƒ…å ±ã®è©³ç´°åº¦' : 'How precise your location is shown'"></p>
                    </div>
                    <template x-if="!editingProfile">
                        <span class="px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600" x-text="t.profile.locationOptions[user?.privacy?.locationPrecision]"></span>
                    </template>
                    <template x-if="editingProfile">
                        <select class="input text-sm py-1 px-2">
                            <option value="exact" :selected="user?.privacy?.locationPrecision === 'exact'" x-text="t.profile.locationOptions.exact"></option>
                            <option value="district" :selected="user?.privacy?.locationPrecision === 'district'" x-text="t.profile.locationOptions.district"></option>
                            <option value="hidden" :selected="user?.privacy?.locationPrecision === 'hidden'" x-text="t.profile.locationOptions.hidden"></option>
                        </select>
                    </template>
                </div>
                
                <!-- Contact Method -->
                <div class="flex items-center justify-between">
                    <div>
                        <p class="font-medium text-gray-700" x-text="t.profile.contactMethod"></p>
                        <p class="text-xs text-gray-500" x-text="language === 'ja' ? 'ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã‹ã‚‰ã®é€£çµ¡æ–¹æ³•' : 'How other members can contact you'"></p>
                    </div>
                    <template x-if="!editingProfile">
                        <span class="px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600" x-text="t.profile.contactOptions[user?.privacy?.contactMethod]"></span>
                    </template>
                    <template x-if="editingProfile">
                        <select class="input text-sm py-1 px-2">
                            <option value="inapp" :selected="user?.privacy?.contactMethod === 'inapp'" x-text="t.profile.contactOptions.inapp"></option>
                            <option value="email" :selected="user?.privacy?.contactMethod === 'email'" x-text="t.profile.contactOptions.email"></option>
                            <option value="phone" :selected="user?.privacy?.contactMethod === 'phone'" x-text="t.profile.contactOptions.phone"></option>
                        </select>
                    </template>
                </div>
            </div>
        </div>
        
        <!-- Save Button (when editing) -->
        <template x-if="editingProfile">
            <button @click="saveProfile()" class="w-full btn btn-primary mb-6">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <span x-text="t.profile.saveProfile"></span>
            </button>
        </template>
    </div>
</div>