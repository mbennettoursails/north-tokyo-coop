<!--
  Modal Components
  
  This file contains reusable modal/dialog templates.
  Modals use Alpine.js for show/hide state management.
  
  Available Modal Types:
  1. Base Modal - Generic modal container
  2. Confirmation Modal - Yes/No confirmation dialogs
  3. Form Modal - Modal with form inputs
  4. Detail Modal - Content detail view modal
  5. Alert Modal - Notification alerts
  6. Bottom Sheet - Mobile-friendly bottom drawer
-->


<!-- ============================================
     BASE MODAL WRAPPER
     ============================================ -->
<!--
  Usage:
  <div x-data="{ showModal: false }">
    <button @click="showModal = true">Open Modal</button>
    
    <template x-if="showModal">
      <div class="modal-overlay" @click.self="showModal = false">
        <div class="modal-container">
          // Modal content here
        </div>
      </div>
    </template>
  </div>
-->

<template id="base-modal-template">
    <div 
        x-show="isOpen"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="modal-overlay"
        @click.self="close()">
        
        <div 
            x-show="isOpen"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 scale-95 translate-y-4"
            x-transition:enter-end="opacity-100 scale-100 translate-y-0"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 scale-100 translate-y-0"
            x-transition:leave-end="opacity-0 scale-95 translate-y-4"
            class="modal-container"
            @click.stop>
            
            <!-- Modal Header -->
            <div class="modal-header" x-show="showHeader">
                <h3 class="modal-title" x-text="title"></h3>
                <button @click="close()" class="modal-close-btn">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Content slot -->
            </div>
            
            <!-- Modal Footer -->
            <div class="modal-footer" x-show="showFooter">
                <!-- Actions slot -->
            </div>
        </div>
    </div>
</template>


<!-- ============================================
     CONFIRMATION MODAL
     ============================================ -->
<!--
  Usage:
  showConfirmModal({
    title: '削除の確認',
    message: 'この項目を削除しますか？',
    confirmText: '削除',
    cancelText: 'キャンセル',
    type: 'danger', // 'danger', 'warning', 'info'
    onConfirm: () => { // do something },
    onCancel: () => { // do something }
  });
-->

<template id="confirm-modal-template">
    <div class="modal-overlay" x-show="showConfirmModal" @click.self="closeConfirm()">
        <div class="modal-container modal-sm">
            <!-- Icon -->
            <div class="modal-icon-wrapper" :class="confirmModalType === 'danger' ? 'bg-red-100' : confirmModalType === 'warning' ? 'bg-yellow-100' : 'bg-blue-100'">
                <!-- Danger Icon -->
                <svg x-show="confirmModalType === 'danger'" class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                <!-- Warning Icon -->
                <svg x-show="confirmModalType === 'warning'" class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <!-- Info Icon -->
                <svg x-show="confirmModalType === 'info'" class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            
            <!-- Content -->
            <div class="text-center mt-4">
                <h3 class="modal-title mb-2" x-text="confirmModalTitle"></h3>
                <p class="text-sm text-gray-600" x-text="confirmModalMessage"></p>
            </div>
            
            <!-- Actions -->
            <div class="modal-footer flex space-x-3 mt-6">
                <button @click="closeConfirm()" class="flex-1 btn btn-outline">
                    <span x-text="confirmModalCancelText || t.common.cancel"></span>
                </button>
                <button 
                    @click="confirmAction()" 
                    class="flex-1 btn"
                    :class="confirmModalType === 'danger' ? 'btn-danger' : confirmModalType === 'warning' ? 'btn-warning' : 'btn-primary'">
                    <span x-text="confirmModalConfirmText || t.common.confirm"></span>
                </button>
            </div>
        </div>
    </div>
</template>


<!-- ============================================
     ALERT/TOAST MODAL
     ============================================ -->
<!--
  Usage:
  showAlert({
    type: 'success', // 'success', 'error', 'warning', 'info'
    message: 'Operation completed successfully',
    duration: 3000 // auto-dismiss after 3 seconds
  });
-->

<template id="alert-template">
    <div 
        x-show="showAlert"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0 translate-y-4"
        x-transition:enter-end="opacity-100 translate-y-0"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0"
        x-transition:leave-end="opacity-0 translate-y-4"
        class="alert-container"
        :class="getAlertClass()">
        
        <!-- Icon -->
        <div class="alert-icon">
            <!-- Success -->
            <svg x-show="alertType === 'success'" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
            <!-- Error -->
            <svg x-show="alertType === 'error'" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
            </svg>
            <!-- Warning -->
            <svg x-show="alertType === 'warning'" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <!-- Info -->
            <svg x-show="alertType === 'info'" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
        </div>
        
        <!-- Message -->
        <p class="alert-message" x-text="alertMessage"></p>
        
        <!-- Close Button -->
        <button @click="dismissAlert()" class="alert-close">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
    </div>
</template>


<!-- ============================================
     BOTTOM SHEET MODAL
     ============================================ -->
<!--
  Usage:
  <div x-data="{ showSheet: false }">
    <button @click="showSheet = true">Open Sheet</button>
    
    <template x-if="showSheet">
      Include bottom-sheet-template content
    </template>
  </div>
-->

<template id="bottom-sheet-template">
    <div 
        x-show="isOpen"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="bottom-sheet-overlay"
        @click.self="close()">
    </div>
    
    <div 
        x-show="isOpen"
        x-transition:enter="transition ease-out duration-300 transform"
        x-transition:enter-start="translate-y-full"
        x-transition:enter-end="translate-y-0"
        x-transition:leave="transition ease-in duration-200 transform"
        x-transition:leave-start="translate-y-0"
        x-transition:leave-end="translate-y-full"
        class="bottom-sheet"
        @click.away="close()">
        
        <!-- Drag Handle -->
        <div class="bottom-sheet-handle">
            <div class="handle-bar"></div>
        </div>
        
        <!-- Header -->
        <div class="bottom-sheet-header" x-show="showHeader">
            <h3 class="bottom-sheet-title" x-text="title"></h3>
            <button @click="close()" class="bottom-sheet-close">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Content -->
        <div class="bottom-sheet-content">
            <!-- Content slot -->
        </div>
    </div>
</template>


<!-- ============================================
     LOADING MODAL
     ============================================ -->

<template id="loading-modal-template">
    <div 
        x-show="isLoading"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="loading-overlay">
        
        <div class="loading-container">
            <!-- Spinner -->
            <div class="loading-spinner">
                <svg class="animate-spin w-10 h-10 text-coop-500" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            
            <!-- Message -->
            <p class="loading-message" x-text="loadingMessage || t.common.loading"></p>
        </div>
    </div>
</template>


<!-- ============================================
     IMAGE VIEWER MODAL
     ============================================ -->

<template id="image-viewer-template">
    <div 
        x-show="showImageViewer"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="image-viewer-overlay"
        @click.self="closeImageViewer()">
        
        <!-- Close Button -->
        <button @click="closeImageViewer()" class="image-viewer-close">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Image -->
        <img :src="viewerImageSrc" :alt="viewerImageAlt" class="image-viewer-img">
        
        <!-- Caption -->
        <div x-show="viewerImageCaption" class="image-viewer-caption">
            <p x-text="viewerImageCaption"></p>
        </div>
    </div>
</template>


<!-- ============================================
     MODAL STYLES
     ============================================ -->
<style>
/* Modal Overlay */
.modal-overlay {
    position: fixed;
    inset: 0;
    z-index: 50;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    background-color: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
}

/* Modal Container */
.modal-container {
    width: 100%;
    max-width: 28rem;
    max-height: calc(100vh - 2rem);
    background-color: white;
    border-radius: 1rem;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.modal-sm {
    max-width: 20rem;
    padding: 1.5rem;
}

.modal-lg {
    max-width: 36rem;
}

.modal-xl {
    max-width: 48rem;
}

.modal-full {
    max-width: 100%;
    height: 100%;
    border-radius: 0;
}

/* Modal Header */
.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid #e5e7eb;
    flex-shrink: 0;
}

.modal-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
}

.modal-close-btn {
    padding: 0.5rem;
    color: #6b7280;
    border-radius: 0.375rem;
    transition: background-color 0.2s, color 0.2s;
    background: none;
    border: none;
    cursor: pointer;
}

.modal-close-btn:hover {
    background-color: #f3f4f6;
    color: #1f2937;
}

/* Modal Body */
.modal-body {
    flex: 1;
    padding: 1.25rem;
    overflow-y: auto;
}

/* Modal Footer */
.modal-footer {
    padding: 1rem 1.25rem;
    border-top: 1px solid #e5e7eb;
    flex-shrink: 0;
}

/* Modal Icon Wrapper */
.modal-icon-wrapper {
    width: 4rem;
    height: 4rem;
    margin: 0 auto;
    border-radius: 9999px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Alert Container */
.alert-container {
    position: fixed;
    top: 1rem;
    left: 50%;
    transform: translateX(-50%);
    z-index: 60;
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    max-width: calc(100vw - 2rem);
}

.alert-container.alert-success {
    background-color: #dcfce7;
    color: #166534;
}

.alert-container.alert-error {
    background-color: #fef2f2;
    color: #991b1b;
}

.alert-container.alert-warning {
    background-color: #fef9c3;
    color: #854d0e;
}

.alert-container.alert-info {
    background-color: #dbeafe;
    color: #1e40af;
}

.alert-icon {
    flex-shrink: 0;
    margin-right: 0.75rem;
}

.alert-message {
    flex: 1;
    font-size: 0.875rem;
    font-weight: 500;
}

.alert-close {
    flex-shrink: 0;
    margin-left: 0.75rem;
    padding: 0.25rem;
    opacity: 0.6;
    transition: opacity 0.2s;
    background: none;
    border: none;
    cursor: pointer;
}

.alert-close:hover {
    opacity: 1;
}

/* Bottom Sheet */
.bottom-sheet-overlay {
    position: fixed;
    inset: 0;
    z-index: 40;
    background-color: rgba(0, 0, 0, 0.5);
}

.bottom-sheet {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 50;
    background-color: white;
    border-top-left-radius: 1.5rem;
    border-top-right-radius: 1.5rem;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15);
}

.bottom-sheet-handle {
    display: flex;
    justify-content: center;
    padding: 0.75rem 0;
}

.handle-bar {
    width: 2.5rem;
    height: 0.25rem;
    background-color: #d1d5db;
    border-radius: 9999px;
}

.bottom-sheet-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 1rem 0.75rem;
    border-bottom: 1px solid #e5e7eb;
}

.bottom-sheet-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
}

.bottom-sheet-close {
    padding: 0.5rem;
    color: #6b7280;
    border-radius: 9999px;
    transition: background-color 0.2s;
    background: none;
    border: none;
    cursor: pointer;
}

.bottom-sheet-close:hover {
    background-color: #f3f4f6;
}

.bottom-sheet-content {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
    padding-bottom: calc(1rem + env(safe-area-inset-bottom));
}

/* Loading Overlay */
.loading-overlay {
    position: fixed;
    inset: 0;
    z-index: 60;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: rgba(255, 255, 255, 0.9);
}

.loading-container {
    display: flex;
    flex-direction: column;
    align-items: center;
}

.loading-spinner {
    margin-bottom: 1rem;
}

.loading-message {
    font-size: 0.875rem;
    color: #6b7280;
}

/* Image Viewer */
.image-viewer-overlay {
    position: fixed;
    inset: 0;
    z-index: 60;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 0, 0, 0.95);
}

.image-viewer-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.5rem;
    color: white;
    opacity: 0.8;
    transition: opacity 0.2s;
    background: none;
    border: none;
    cursor: pointer;
    z-index: 10;
}

.image-viewer-close:hover {
    opacity: 1;
}

.image-viewer-img {
    max-width: 90vw;
    max-height: 90vh;
    object-fit: contain;
}

.image-viewer-caption {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    padding: 0.5rem 1rem;
    background-color: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    max-width: 90vw;
    text-align: center;
}

/* Button Styles (for modal use) */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.75rem 1.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    border-radius: 0.5rem;
    transition: all 0.2s;
    cursor: pointer;
    border: none;
}

.btn-primary {
    background-color: #86bd5e;
    color: white;
}

.btn-primary:hover {
    background-color: #7aad54;
}

.btn-danger {
    background-color: #ef4444;
    color: white;
}

.btn-danger:hover {
    background-color: #dc2626;
}

.btn-warning {
    background-color: #f59e0b;
    color: white;
}

.btn-warning:hover {
    background-color: #d97706;
}

.btn-outline {
    background-color: transparent;
    border: 1px solid #d1d5db;
    color: #374151;
}

.btn-outline:hover {
    background-color: #f3f4f6;
}

/* Responsive */
@media (max-width: 640px) {
    .modal-container {
        max-width: 100%;
        margin: 0;
        border-radius: 0;
        max-height: 100vh;
    }
    
    .modal-overlay {
        padding: 0;
        align-items: flex-end;
    }
    
    .modal-container:not(.modal-sm) {
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
    }
}
</style>